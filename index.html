<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WE'RE NUTS</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="WE'RE NUTS">
    
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/lucasmaia2709-lang/nuts/refs/heads/main/nuts.png">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/lucasmaia2709-lang/nuts/refs/heads/main/nuts.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700;800&family=Cormorant+Garamond:wght@300;400;500&family=Major+Mono+Display&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css?v=6">
    <style>html, body { overscroll-behavior: none; }</style>
</head>
<body>

    <div id="toast-container"></div>

    <!-- 0. LANDING -->
    <div id="view-landing" class="screen active" style="background:#9cafcc;align-items: center; justify-content: center; text-align: center;padding: 40px">
        <div class="logo-container-large">
            <span class="logo-were">WE'RE</span><br>
            <span class="logo-nuts">nuts</span>
        </div>
        <p style="color: #ffff; letter-spacing: 2px; font-size: 12px; margin-top: 10px; font-weight: 600;">Sua jornada começa agora</p>
        <div style="width: 100%; margin-top: 80px;">
            <button onclick="window.app.goToRegister()" class="btn btn-primary" style="margin-bottom: 15px; background: #1b265b; box-shadow:none; border:2px solid #FFF;">Começar Agora</button>
            <button onclick="window.app.goToLogin()" class="btn btn-text" style="color: #dbffae;">Já tenho conta</button>
        </div>
    </div>

    <!-- 1. LOGIN -->
    <div id="view-login" class="screen" style="background:#9cafcc;justify-content: center; padding: 40px;">
        <button onclick="window.app.goToLanding()" style="position:absolute; top:50px; left:20px; border:none; background:none; font-size:24px; color:var(--text-main);"><i class="fa-solid fa-arrow-left"></i></button>
        
        <!-- LOGO ADICIONADO AQUI -->
        <div class="logo-container-large" style="margin-bottom: 20px; transform: scale(0.8);">
            <span class="logo-were">WE'RE</span><br>
            <span class="logo-nuts">nuts</span>
        </div>

        <h1 style="font-size: 32px; margin-bottom: 40px; text-align:center; color: #dbffae;">Login</h1>
        <form onsubmit="window.app.handleLogin(event)">
            <div class="input-group"><label class="label">Email</label><input type="email" id="log-email" class="input" required></div>
            <div class="input-group"><label class="label">Senha</label><input type="password" id="log-pass" class="input" required></div>
            <button type="submit" class="btn btn-primary" style="margin-top: 20px; background: #dbffae; color:#ff66c4">Entrar</button>
        </form>
        <p onclick="window.app.forgotPassword()" style="text-align: center; color:#1b265b; font-size: 13px; margin-top: 20px; cursor: pointer; text-decoration: underline;">Esqueci minha senha</p>
    </div>

    <!-- 2. CADASTRO -->
    <div id="view-register" class="screen" style="background:#9cafcc;justify-content: center; padding: 40px;">
        <button onclick="window.app.goToLanding()" style="position:absolute; top:50px; left:20px; border:none; background:none; font-size:18px; color:var(--text-main);"><i class="fa-solid fa-arrow-left"></i></button>
        
        <!-- LOGO ADICIONADO PARA CONSISTÊNCIA -->
        <div class="logo-container-large" style="margin-bottom: 20px; transform: scale(0.8);">
            <span class="logo-were">WE'RE</span><br>
            <span class="logo-nuts">nuts</span>
        </div>

        <h1 style="font-size: 32px; margin-bottom: 40px; text-align:center; color: #dbffae;">Criar Conta</h1>
        <form onsubmit="window.app.handleRegister(event)">
            <div class="input-group"><label class="label">Nome</label><input type="text" id="reg-name" class="input" required></div>
            <div class="input-group"><label class="label">Email</label><input type="email" id="reg-email" class="input" required></div>
            <div class="input-group"><label class="label">Senha</label><input type="password" id="reg-pass" class="input" required></div>
            <button type="submit" class="btn btn-primary" style="margin-top: 20px;background: #dbffae;color:#ff66c4">Cadastrar</button>
        </form>
    </div>

    <!-- 3. PENDENTE -->
    <div id="view-pending" class="screen" style="align-items: center; justify-content: center; padding: 40px; text-align: center;">
        <div style="background:#FFF; padding:40px; border-radius:30px; box-shadow:var(--shadow);">
            <i class="fa-regular fa-clock" style="font-size: 50px; color: var(--primary); margin-bottom: 20px;"></i>
            <h2 style="color:var(--text-main);">Aprovação Pendente</h2>
            <p style="color: var(--text-sec); font-size: 14px;">Seu treinador precisa liberar seu acesso.</p>
            <button onclick="window.app.logout()" class="btn btn-outline" style="margin-top: 30px;">Sair</button>
        </div>
    </div>

    <!-- 4. APP PRINCIPAL -->
    <div id="view-app" class="screen">
        <div class="app-header">
            <div class="header-avatar" onclick="window.app.openProfile()">
                <img id="header-avatar-img" src="" style="width:100%; height:100%; object-fit:cover; display:none;">
                <span id="header-avatar-txt">U</span>
            </div>
            
            <div class="logo-container-small">
                <span class="logo-nuts-small">nuts</span>
            </div>

            <div style="width: 40px; display: flex; justify-content: flex-end;">
                 <button id="btn-admin-access" onclick="window.app.loadAdmin()" style="border:none; background:none; color:var(--primary); font-size:18px; display:none;"><i class="fa-solid fa-lock"></i></button>
            </div>
        </div>

        <div id="main-scroll">
            <!-- ABA HOME -->
            <div id="tab-home" class="tab-content">
                <div class="calendar-wrapper">
                    <div class="calendar-header">
                        <button onclick="window.app.changeMonth(-1)" style="border:none; background:none; padding:10px; cursor:pointer;"><i class="fa-solid fa-chevron-left" style="color:var(--text-main);"></i></button>
                        <span id="cal-month-title" class="calendar-title">Mês</span>
                        <button onclick="window.app.changeMonth(1)" style="border:none; background:none; padding:10px; cursor:pointer;"><i class="fa-solid fa-chevron-right" style="color:var(--text-main);"></i></button>
                    </div>
                    <div class="calendar-grid" style="margin-bottom: 5px;">
                        <div class="cal-head-day">D</div><div class="cal-head-day">S</div><div class="cal-head-day">T</div><div class="cal-head-day">Q</div><div class="cal-head-day">Q</div><div class="cal-head-day">S</div><div class="cal-head-day">S</div>
                    </div>
                    <div id="calendar-days" class="calendar-grid"></div>
                </div>
                <div style="padding: 20px;">
                <div class="card" style="background: #9cafcc;color: var(--text-main); border: none; padding: 30px; text-align: center; margin-bottom: 20px;">
                        <h3 style="font-size: 14px; margin: 0 0 20px; opacity: 0.7; color:var(--text-main);">Motivação do Dia</h3>
                        <i class="fa-solid fa-quote-left" style="color: rgba(255,255,255,0.5); font-size: 32px;"></i>
                        <p id="daily-quote" style="font-style: italic; font-size: 20px; margin: 20px 0 10px; line-height: 1.4; color:var(--text-main);">Carregando...</p> 
                </div>
                </div>
                <div style="padding: 0 20px;">
                    <h3 style="font-size: 18px; margin: 10px 0 15px; color:var(--text-main);">Treino de Hoje</h3>
                    <div id="today-workout-card"></div>
                    <div id="home-latest-news" style="margin-top: 30px;"></div>
                </div>
            </div>

            <!-- ABA MEU PLANO -->
            <div id="tab-workouts" class="tab-content hidden" style="padding: 0 20px;">
                <h2 style="margin: 20px 0; color:var(--text-main);">Meu Plano</h2>
                <div id="workouts-list"></div>
            </div>

            <!-- ABA SAÚDE -->
            <div id="tab-health" class="tab-content hidden" style="padding: 0 20px;">
                <h2 style="margin: 20px 0; color:var(--text-main);">Minha Saúde</h2>
                <div class="card" onclick="window.app.openHealthNutri()" style="cursor: pointer; transition: transform 0.2s; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: #e0f2f1; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #009688; font-size: 20px;"><i class="fa-solid fa-carrot"></i></div>
                            <div><h3 style="margin:0; font-size: 18px; color: var(--text-main);">Meu Nutri</h3><p style="margin:0; font-size: 12px; color: var(--text-sec);">Dieta e suplementação</p></div>
                        </div>
                        <i class="fa-solid fa-chevron-right" style="color: #ccc;"></i>
                    </div>
                </div>
                <div class="card" onclick="window.app.openHealthPhysio()" style="cursor: pointer; transition: transform 0.2s; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: #e3f2fd; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 20px;"><i class="fa-solid fa-user-doctor"></i></div>
                            <div><h3 style="margin:0; font-size: 18px; color: var(--text-main);">Meu Fisio</h3><p style="margin:0; font-size: 12px; color: var(--text-sec);">Relatos e tratamentos</p></div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span id="health-badge-counter" class="hidden" style="background: var(--red); color: white; font-size: 10px; padding: 4px 8px; border-radius: 10px; font-weight: 700;">0</span>
                            <i class="fa-solid fa-chevron-right" style="color: #ccc;"></i>
                        </div>
                    </div>
                </div>
                <div class="card" onclick="window.app.openHealthMental()" style="cursor: pointer; transition: transform 0.2s; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: #f3e5f5; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #9c27b0; font-size: 20px;"><i class="fa-solid fa-brain"></i></div>
                            <div><h3 style="margin:0; font-size: 18px; color: var(--text-main);">Mental Health</h3><p style="margin:0; font-size: 12px; color: var(--text-sec);">Equilíbrio e bem-estar</p></div>
                        </div>
                        <i class="fa-solid fa-chevron-right" style="color: #ccc;"></i>
                    </div>
                </div>
            </div>

            <!-- ABA COMUNIDADE -->
            <div id="tab-social" class="tab-content hidden" style="padding: 0 20px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin: 20px 0;">
                    <h2 style="margin:0; color:var(--text-main);">Comunidade</h2>
                    <button onclick="window.app.openCreatePost()" class="btn-primary" style="width: auto; padding: 8px 16px; border-radius: 20px; font-size: 12px; border:none; cursor:pointer;"><i class="fa-solid fa-plus"></i> Novo</button>
                </div>
                <div id="social-feed"></div>
            </div>

            <!-- ABA NOVIDADES -->
            <div id="tab-news" class="tab-content hidden" style="padding: 0 20px;">
                <h2 style="margin: 20px 0; color:var(--text-main);">Novidades</h2>
                <div id="news-feed"></div>
            </div>
        </div>

        <div class="nav-bar">
            <button class="nav-item" onclick="window.app.nav('social')" data-tab="social"><i class="fa-solid fa-users"></i></button>
            <button class="nav-item" onclick="window.app.nav('health')" data-tab="health" style="position: relative;"><i class="fa-solid fa-heart-pulse"></i><span id="nav-badge-health" class="hidden" style="position: absolute; top: 5px; right: 25%; width: 8px; height: 8px; background: var(--red); border-radius: 50%; border: 1px solid white;"></span></button>
            <button class="nav-item active" onclick="window.app.nav('home')" data-tab="home"><i class="fa-solid fa-house"></i></button>
            <button class="nav-item" onclick="window.app.nav('workouts')" data-tab="workouts"><i class="fa-solid fa-person-running"></i></button>
            <button class="nav-item" onclick="window.app.nav('news')" data-tab="news"><i class="fa-solid fa-bullhorn"></i></button>
        </div>
    </div>

    <!-- TELA DE PERFIL (SAFE AREA CORRIGIDA) -->
    <div id="view-profile" class="screen full-screen" style="overflow-y: auto; -webkit-overflow-scrolling: touch;">
        <div style="padding: 20px; padding-top: max(40px, calc(env(safe-area-inset-top) + 20px)); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: var(--bg); z-index: 10;">
            <button onclick="window.app.closeProfile()" style="border:none; background:none; font-size:24px; cursor:pointer; color:var(--text-main);"><i class="fa-solid fa-times"></i></button>
            <h3 style="margin:0;">Meu Perfil</h3>
            <button onclick="window.app.logout()" style="border:none; background:none; color:var(--red); font-weight:600; cursor:pointer;">Sair</button>
        </div>
        <div style="padding: 20px; text-align: center;">
            <div style="width: 120px; height: 120px; border-radius: 50%; background: #FFF; margin: 0 auto 20px; overflow: hidden; position: relative; cursor:pointer; border: 4px solid #FFF; box-shadow: var(--shadow);" onclick="document.getElementById('profile-upload').click()">
                <img id="profile-img-big" src="" style="width:100%; height:100%; object-fit:cover; display:none;">
                <div style="position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; font-size: 10px; padding: 4px;">ALTERAR</div>
            </div>
            <input type="file" id="profile-upload" hidden accept="image/*" onchange="window.app.uploadAvatar(this)">
            <h2 id="profile-name-big" style="margin:0; font-size:28px; color:var(--text-main);">NOME</h2>
            <p id="profile-email-big" style="color: var(--text-sec); font-size: 16px;">EMAIL</p>
            
            <div class="card" style="text-align: left; margin-top: 20px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h4 style="margin:0; color:var(--primary);">Dados Pessoais</h4>
                    <button id="btn-edit-profile" onclick="window.app.toggleEditProfile(true)" style="font-size:12px; color:var(--text-sec); border:1px solid var(--border); background:white; padding:4px 10px; border-radius:10px;">Alterar Perfil</button>
                </div>
                <div id="profile-form-container">
                    <label class="label">Data de Nascimento</label><input id="prof-birth" type="date" class="input" disabled style="margin-bottom:10px;">
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1;"><label class="label">Cidade</label><input id="prof-city" class="input" disabled style="margin-bottom:10px;"></div>
                        <div style="flex:1;"><label class="label">País</label><input id="prof-country" class="input" disabled style="margin-bottom:10px;"></div>
                    </div>
                    <label class="label">Altura (cm)</label><input id="prof-height" type="number" class="input" disabled style="margin-bottom:10px;">
                    
                    <!-- NOVOS CAMPOS REDES SOCIAIS -->
                    <h4 style="margin:20px 0 10px 0; color:var(--primary); font-size:14px; border-top:1px dashed #eee; padding-top:15px;">Redes Sociais (Opcional)</h4>
                    
                    <div class="input-group" style="margin-bottom:10px;">
                        <label class="label"><i class="fa-brands fa-instagram"></i> Instagram (Link ou @)</label>
                        <input id="prof-social-insta" class="input" disabled placeholder="@seu.perfil">
                    </div>
                    
                    <div class="input-group" style="margin-bottom:10px;">
                        <label class="label"><i class="fa-brands fa-facebook"></i> Facebook (Link)</label>
                        <input id="prof-social-face" class="input" disabled placeholder="Link do perfil">
                    </div>

                    <div class="input-group" style="margin-bottom:10px;">
                        <label class="label"><i class="fa-brands fa-tiktok"></i> TikTok (Link ou @)</label>
                        <input id="prof-social-tiktok" class="input" disabled placeholder="@seu.perfil">
                    </div>

                    <div id="profile-edit-actions" style="display:none; gap:10px; margin-top:15px;">
                        <button onclick="window.app.saveProfile()" class="btn btn-primary">Salvar</button>
                        <button onclick="window.app.toggleEditProfile(false)" class="btn btn-outline">Cancelar</button>
                    </div>
                </div>
            </div>

            <div class="card" style="text-align: left; margin-top: 20px; padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div><label class="label" style="font-size: 12px; color: var(--text-sec);">Peso Atual</label><div id="display-current-weight" style="font-size: 32px; font-weight: 700; color: var(--text-main);">--</div></div>
                    <button onclick="window.app.openWeightModal()" style="width: 50px; height: 50px; border-radius: 50%; background: var(--primary); color: white; border: none; font-size: 24px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center;"><i class="fa-solid fa-plus"></i></button>
                </div>
                <div style="border-top: 1px dashed #eee; padding-top: 15px;"><label class="label" style="margin-bottom: 10px; display: block; font-size: 11px; opacity: 0.7;">HISTÓRICO</label><div id="weight-history-list" style="max-height: 150px; overflow-y: auto;"></div></div>
            </div>

            <button id="btn-add-race" onclick="window.app.showAddRaceModal()" class="btn btn-primary" style="margin-top: 30px;">+ Novo Objetivo</button>
            <div class="card" style="margin-top: 40px; text-align: left;">
                <h4 style="margin-top:0; color:var(--primary);">Histórico de Provas</h4>
                <div id="profile-history"></div>
            </div>
        </div>
    </div>

    <!-- TELA DE PERFIL PÚBLICO (SOCIAL) -->
    <div id="view-public-profile" class="screen full-screen" style="overflow-y: auto; -webkit-overflow-scrolling: touch; background: #fff;">
        <div style="padding: 20px; padding-top: max(20px, env(safe-area-inset-top)); position: sticky; top: 0; background: #fff; z-index: 10; display:flex; align-items:center;">
             <button onclick="window.app.closePublicProfile()" style="border:none; background:none; font-size:24px; cursor:pointer; color:var(--text-main); margin-right: 15px;"><i class="fa-solid fa-arrow-left"></i></button>
             <h3 style="margin:0; font-size: 16px;">Perfil do Atleta</h3>
        </div>
        
        <div style="padding: 0 20px 40px 20px; text-align: center;">
            <!-- Avatar e Info -->
            <div style="width: 100px; height: 100px; border-radius: 50%; margin: 10px auto; overflow: hidden; border: 3px solid var(--primary);">
                <img id="pp-avatar" src="" style="width:100%; height:100%; object-fit:cover;">
            </div>
            <h2 id="pp-name" style="margin: 10px 0 5px 0; color:var(--text-main); font-size: 22px;">Nome</h2>
            <p id="pp-location" style="color:var(--text-sec); font-size: 14px; margin: 0 0 15px 0;"><i class="fa-solid fa-location-dot"></i> <span>Cidade, País</span></p>
            
            <!-- Redes Sociais -->
            <div id="pp-social-links" style="display:flex; justify-content:center; gap: 20px; margin-bottom: 30px;">
                <!-- Injetado via JS -->
            </div>

            <!-- Galeria -->
            <div style="border-top: 1px solid #eee; padding-top: 20px; text-align: left;">
                <h4 style="margin: 0 0 15px 0; color: var(--text-main); font-size: 16px;"><i class="fa-solid fa-camera"></i> Galeria de Treinos</h4>
                <div id="pp-gallery-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px;">
                    <!-- Fotos injetadas via JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- TELA DE DETALHE DE POSTS (NOVA) -->
    <div id="view-post-detail" class="screen full-screen" style="overflow-y: auto; background: #f4f7f9;">
        <div style="padding: 10px 20px; padding-top: max(15px, env(safe-area-inset-top)); display: flex; align-items: center; position: sticky; top: 0; background: #f4f7f9; z-index: 50; border-bottom: 1px solid #eee;">
            <button onclick="window.app.closePostDetail()" style="border:none; background:none; font-size:24px; cursor:pointer; color:var(--text-main); margin-right: 15px;"><i class="fa-solid fa-arrow-left"></i></button>
            <h3 style="margin:0; font-size: 16px;">Publicações</h3>
        </div>
        <div id="post-detail-feed" style="padding: 0 20px 40px 20px;">
            <!-- Posts injetados via JS -->
        </div>
    </div>

    <!-- TELA DETALHE NOTICIA (CORRIGIDO: REMOVIDO DISPLAY:FLEX INLINE) -->
    <div id="view-news-detail" class="screen detail-view" style="flex-direction: column; background: #fff; height: 100%;">
        <button onclick="window.app.closeNewsDetail()" style="position:absolute; top: max(20px, env(safe-area-inset-top)); left:20px; z-index:10; background:white; border:none; width:45px; height:45px; border-radius:50%; box-shadow:0 5px 15px rgba(0,0,0,0.1); cursor:pointer; display:flex; justify-content:center; align-items:center;"><i class="fa-solid fa-arrow-left" style="color:var(--text-main);"></i></button>
        
        <!-- Imagem Fixa no Topo (Não Rola) -->
        <div id="news-det-img-container" style="width:100%; height:300px; flex-shrink: 0; background:grey; background-size:cover; background-position:center; background-color: #EEE; display: none;"></div>
        
        <!-- Conteúdo Rolável (Flex 1) -->
        <div style="flex: 1; overflow-y: auto; background:var(--bg); border-radius:30px 30px 0 0; margin-top:-30px; padding:30px; position:relative; z-index: 2; -webkit-overflow-scrolling: touch;">
            <div id="news-det-date" style="font-size: 12px; color: var(--text-sec); font-weight: 700; margin-bottom: 10px;">DATA</div>
            <h1 id="news-det-title" style="margin:0 0 20px 0; color:var(--text-main); line-height: 1.3;">TITULO</h1>
            <div id="news-det-body" style="color:var(--text-main); line-height:1.6; font-size: 16px; white-space: pre-line; padding-bottom: 40px;"></div>
        </div>
    </div>

    <!-- TELAS DE SAÚDE (RESTAURADAS) -->
    <div id="view-health-nutri" class="screen full-screen" style="overflow-y: auto;">
        <div style="padding: 20px; padding-top: max(20px, env(safe-area-inset-top)); display: flex; align-items: center; background: #FFF; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 50;">
            <button onclick="window.app.closeHealthSubView()" style="border:none; background:none; font-size:24px; cursor:pointer; color:var(--text-main); margin-right: 15px;"><i class="fa-solid fa-arrow-left"></i></button>
            <h3 style="margin:0; color: #009688;">Meu Nutri</h3>
        </div>
        <div style="padding: 20px; text-align: center;">
            <div class="card" style="padding: 40px 20px;">
                <i class="fa-solid fa-carrot" style="font-size: 50px; color: #e0f2f1; margin-bottom: 20px;"></i>
                <h2 style="color: var(--text-main);">Em breve</h2>
            </div>
        </div>
    </div>

    <div id="view-health-physio" class="screen full-screen" style="overflow-y: auto;">
        <div style="padding: 20px; padding-top: max(20px, env(safe-area-inset-top)); display: flex; align-items: center; background: #FFF; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 50;">
            <button onclick="window.app.closeHealthSubView()" style="border:none; background:none; font-size:24px; cursor:pointer; color:var(--text-main); margin-right: 15px;"><i class="fa-solid fa-arrow-left"></i></button>
            <h3 style="margin:0; color: var(--primary);">Meu Fisio</h3>
        </div>
        <div style="padding: 20px;">
            <div class="card" style="margin-bottom: 20px;"><p style="font-size: 14px; color: var(--text-sec); margin-top: 0;">Histórico de dores registradas.</p></div>
            <h4 style="margin: 0 0 15px 0; color: var(--text-main);">Histórico</h4>
            <div id="health-pain-list" style="display: flex; flex-direction: column; gap: 10px;"></div>
        </div>
    </div>

    <div id="view-health-mental" class="screen full-screen" style="overflow-y: auto;">
        <div style="padding: 20px; padding-top: max(20px, env(safe-area-inset-top)); display: flex; align-items: center; background: #FFF; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 50;">
            <button onclick="window.app.closeHealthSubView()" style="border:none; background:none; font-size:24px; cursor:pointer; color:var(--text-main); margin-right: 15px;"><i class="fa-solid fa-arrow-left"></i></button>
            <h3 style="margin:0; color: #9c27b0;">Mental Health</h3>
        </div>
        <div style="padding: 20px; text-align: center;">
            <div class="card" style="padding: 40px 20px;">
                <i class="fa-solid fa-brain" style="font-size: 50px; color: #f3e5f5; margin-bottom: 20px;"></i>
                <h2 style="color: var(--text-main);">Espaço Mental</h2>
            </div>
        </div>
    </div>

    <div id="view-create-post" class="screen full-screen">
        <div style="padding: 15px 20px; display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); padding-top:max(15px, env(safe-area-inset-top));">
            <button onclick="window.app.closeCreatePost()" class="btn-text" style="padding:10px; font-weight:600;">Cancelar</button>
            <strong style="font-size:18px; color:var(--text-main);">Criar Post</strong>
            <button id="btn-submit-post" onclick="window.app.submitPost()" style="border:none; background:var(--primary); color:white; padding: 8px 20px; border-radius: 20px; font-weight:600; cursor:pointer;">Postar</button>
        </div>
        <textarea id="post-text" style="width:100%; height:200px; border:none; padding:25px; font-family:var(--font-main); font-size:18px; outline:none; resize:none; background:transparent; color:var(--text-main);" placeholder="No que você está pensando?"></textarea>
        <div style="padding: 20px;">
            <div id="post-img-preview" style="width:100%; height:200px; background:#fff; border-radius:20px; display:none; background-size:cover; background-position:center; margin-bottom:20px;"></div>
            <button onclick="document.getElementById('post-file').click()" class="btn btn-outline" style="border-radius:30px; background:#fff;"><i class="fa-solid fa-camera"></i>&nbsp; Adicionar Foto</button>
            <input type="file" id="post-file" hidden accept="image/*" onchange="window.app.previewPostImg(this)">
        </div>
    </div>

    <!-- MODAIS -->
    
    <!-- Modal Vídeo Genérico -->
    <div id="modal-video" class="modal-overlay"><div style="width: 100%; max-width: 800px; aspect-ratio: 16/9; background: #000; position: relative; border-radius:20px; overflow:hidden;">
        <!-- BOTÃO FECHAR SAFE AREA -->
        <button onclick="document.getElementById('modal-video').classList.remove('active'); document.getElementById('video-container').innerHTML='';" 
                style="position: absolute; top: max(30px, env(safe-area-inset-top)); right: max(20px, env(safe-area-inset-right)); color: white; background: rgba(0,0,0,0.6); width:40px; height:40px; border-radius:50%; border: 2px solid white; font-size: 18px; cursor:pointer; z-index:2001; display:flex; align-items:center; justify-content:center;">✕</button>
        <div id="video-container" style="width:100%; height:100%;"></div>
    </div></div>
    
    <!-- Modal de Vídeos de Fortalecimento (QUE ESTAVA FALTANDO) -->
    <div id="modal-strength-videos" class="modal-overlay">
        <div class="modal-card">
            <h3 style="color:var(--text-main);">Vídeos de Apoio</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Selecione um exercício para assistir:</p>
            <div id="strength-video-list" style="max-height: 300px; overflow-y: auto;">
                <p style="text-align:center; padding:20px;">Carregando...</p>
            </div>
            <div style="margin-top: 15px; text-align: right;">
                <button onclick="document.getElementById('modal-strength-videos').classList.remove('active')" class="btn btn-outline">Fechar</button>
            </div>
        </div>
    </div>

    <div id="modal-day-detail" class="modal-overlay">
        <div class="modal-card">
            <h3 id="day-det-title" style="color:var(--primary);">Detalhes do Dia</h3>
            <div id="day-det-content"></div>
            <textarea id="day-det-note" class="input" placeholder="Anotações / Feedback..." style="height:120px; resize:none; margin-top:15px;"></textarea>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button onclick="document.getElementById('modal-day-detail').classList.remove('active')" class="btn btn-outline">Fechar</button>
                <button onclick="window.app.saveDayNote()" class="btn btn-primary">Salvar Nota</button>
            </div>
        </div>
    </div>

    <div id="modal-edit-date" class="modal-overlay"><div class="modal-card"><h3 style="color:var(--text-main);">Alterar Data da Prova</h3><label class="label">Nova Data</label><input type="date" id="edit-race-date-input" class="input" style="margin-bottom:20px;"><div style="display:flex; gap:10px;"><button onclick="window.app.saveRaceDate()" class="btn btn-primary">Salvar</button><button onclick="document.getElementById('modal-edit-date').classList.remove('active')" class="btn btn-outline">Cancelar</button></div></div></div>

    <div id="modal-finish-workout" class="modal-overlay"><div class="modal-card"><h3 style="color:var(--text-main);">Como foi o treino?</h3><label class="label" style="margin-top:15px; margin-bottom:10px; display:block;">Nível de Dor (0 - 7)</label><div id="pain-scale-container" style="display:flex; justify-content:center; gap: 5px; flex-wrap: wrap; margin-bottom:20px;"></div><label class="label">O que doeu? / Observações:</label><textarea id="workout-feedback-text" class="input" style="height:100px; resize:none; margin-bottom:20px;" placeholder="Descreva aqui..."></textarea><div style="display:flex; gap:10px;"><button onclick="window.app.confirmFinishWorkout()" class="btn btn-primary">Confirmar</button><button onclick="document.getElementById('modal-finish-workout').classList.remove('active')" class="btn btn-outline">Cancelar</button></div></div></div>

    <div id="modal-add-weight" class="modal-overlay"><div class="modal-card"><h3 style="color:var(--text-main);">Registrar Peso</h3><label class="label">Peso (kg)</label><input type="number" id="new-weight-input" class="input" step="0.1" placeholder="Ex: 75.5" style="margin-bottom:20px;"><div style="display:flex; gap:10px;"><button onclick="window.app.saveNewWeight()" class="btn btn-primary">Salvar</button><button onclick="document.getElementById('modal-add-weight').classList.remove('active')" class="btn btn-outline">Cancelar</button></div></div></div>

    <div id="modal-confirm" class="modal-overlay"><div class="modal-card"><h3 id="confirm-title" style="color:var(--text-main);">Tem Certeza?</h3><p id="confirm-text" style="color:var(--text-sec); font-size:15px; line-height:1.5;"></p><div style="display:flex; gap:10px; margin-top:20px;"><button id="confirm-cancel" class="btn btn-outline">Não</button><button id="confirm-ok" class="btn btn-danger">Sim</button></div></div></div>
    
    <div id="modal-prompt" class="modal-overlay"><div class="modal-card"><h3 id="prompt-title" style="color:var(--text-main);">Entrada</h3><input id="prompt-input" class="input"><div style="display:flex; gap:10px; margin-top:10px;"><button id="prompt-cancel" class="btn btn-outline">Cancelar</button><button id="prompt-confirm" class="btn btn-primary">OK</button></div></div></div>

    <div id="modal-add-race" class="modal-overlay">
        <div class="modal-card">
            <h3 style="color:var(--text-main);">Novo Objetivo</h3>
            <label class="label">Nome da Prova</label><input id="new-race-name" class="input" placeholder="Ex: Maratona do Rio" style="margin-bottom:10px;">
            <label class="label">Distância (KM)</label><input id="new-race-dist" class="input" type="number" placeholder="Ex: 21" style="margin-bottom:10px;">
            <label class="label">Tempo Estimado / Ritmo</label><input id="new-race-est-time" class="input" type="text" placeholder="Ex: 2h 00m ou 5:30/km" style="margin-bottom:10px;">
            <label class="label">Data da Prova</label><input type="date" id="new-race-date" class="input" style="margin-bottom:20px;">
            <button onclick="window.app.addStudentRace()" class="btn btn-primary">Gerar Plano & Salvar</button>
            <button onclick="document.getElementById('modal-add-race').classList.remove('active')" class="btn btn-text">Cancelar</button>
        </div>
    </div>

    <!-- MODAIS ADMIN RESTAURADOS -->
    <div id="modal-adm-add-race" class="modal-overlay">
        <div class="modal-card">
            <h3 style="color:var(--text-main);">Adicionar Objetivo (Admin)</h3>
            <label class="label">Nome da Prova</label><input id="adm-race-name" class="input" placeholder="Ex: Maratona SP" style="margin-bottom:10px;">
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <div style="flex:1;"><label class="label">Data Prova</label><input type="date" id="adm-race-date" class="input"></div>
                <div style="flex:1;"><label class="label">Início</label><input type="date" id="adm-start-date" class="input"></div>
            </div>
            <label class="label">Método</label>
            <select id="adm-race-method" class="input" style="margin-bottom:15px;" onchange="window.app.admToggleRaceMode()">
                <option value="ia">Gerar com IA</option>
                <option value="template">Usar Modelo</option>
            </select>
            <div id="adm-race-ia-fields">
                <label class="label">Distância (KM)</label><input id="adm-race-dist" class="input" type="number" placeholder="Ex: 42" style="margin-bottom:10px;">
                <label class="label">Tempo Est. / Ritmo</label><input id="adm-race-time" class="input" placeholder="Ex: 4h 00m" style="margin-bottom:10px;">
                <label class="label">Vídeo de Fortalecimento (Link)</label><input id="adm-race-video" class="input" placeholder="Opcional" style="margin-bottom:10px;">
            </div>
            <div id="adm-race-tpl-fields" class="hidden">
                <label class="label">Selecionar Modelo</label><select id="adm-race-template-select" class="input" style="margin-bottom:10px;"></select>
            </div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="window.app.admConfirmAddRace()" class="btn btn-primary">Criar</button>
                <button onclick="document.getElementById('modal-adm-add-race').classList.remove('active')" class="btn btn-outline">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modal-add-single-workout" class="modal-overlay">
        <div class="modal-card">
            <h3 id="modal-workout-title" style="color:var(--text-main);">Novo Treino</h3>
            <input id="new-w-title" class="input" placeholder="Título (ex: Trote Leve)" style="margin-bottom:15px;">
            <input id="new-w-desc" class="input" placeholder="Descrição (ex: 30min Zona 2)" style="margin-bottom:15px;">
            <input id="new-w-video" class="input" placeholder="Link do Vídeo (Opcional)" style="margin-bottom:15px;">
            <div style="display:flex; gap:10px;">
                <button onclick="window.app.saveSingleWorkout()" class="btn btn-primary">Salvar</button>
                <button onclick="document.getElementById('modal-add-single-workout').classList.remove('active')" class="btn btn-outline">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modal-admin-pain-response" class="modal-overlay">
        <div class="modal-card">
            <h3 style="color:var(--text-main);">Orientação do Fisio</h3>
            <div id="adm-pain-detail-view" style="margin-bottom: 20px; font-size: 14px; color: #555; background: #f9f9f9; padding: 10px; border-radius: 10px;"></div>
            <label class="label">Resposta / Recomendação</label>
            <textarea id="adm-pain-response-text" class="input" style="height:120px; resize:none; margin-bottom:20px;" placeholder="Ex: Aplique gelo e descanse por 2 dias..."></textarea>
            <div style="display:flex; gap:10px;">
                <button onclick="window.app.admSendPainResponse()" class="btn btn-primary">Enviar</button>
                <button onclick="document.getElementById('modal-admin-pain-response').classList.remove('active')" class="btn btn-outline">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modal-select-template" class="modal-overlay">
        <div class="modal-card">
            <h3 style="color:var(--text-main);">Selecionar Modelo</h3>
            <div id="template-select-list" style="max-height: 250px; overflow-y: auto; border:1px solid #eee; border-radius:15px; padding:10px; margin-bottom:20px;"></div>
            <div style="margin-bottom: 20px;">
                <label class="label">Data de Início:</label>
                <input type="date" id="template-start-date" class="input">
            </div>
            <div style="display:flex; gap:10px;">
                <button onclick="window.app.confirmTemplateImport()" class="btn btn-primary">Importar</button>
                <button onclick="document.getElementById('modal-select-template').classList.remove('active')" class="btn btn-outline">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- PAINEL ADMIN REDESENHADO (NOVO) -->
    <div id="view-admin" class="screen full-screen admin-layout">
        
        <aside class="admin-sidebar">
            <div class="admin-brand">
                <span class="logo-nuts-small" style="font-size:30px;">nuts</span>
                <span style="font-size:10px; opacity:0.6; display:block; letter-spacing:2px; margin-top:-5px;">ADMIN PANEL</span>
            </div>
            <nav class="admin-nav">
                <button onclick="window.app.admTab('users')" id="btn-adm-users" class="admin-nav-item active"><i class="fa-solid fa-users"></i> Alunos</button>
                <button onclick="window.app.admTab('physio')" id="btn-adm-physio" class="admin-nav-item"><div style="display:flex; justify-content:space-between; align-items:center; width:100%;"><span><i class="fa-solid fa-user-doctor"></i> Fisio</span><span id="adm-physio-badge" class="admin-badge hidden">0</span></div></button>
                <button onclick="window.app.admTab('templates')" id="btn-adm-templates" class="admin-nav-item"><i class="fa-solid fa-copy"></i> Modelos</button>
                <button onclick="window.app.admTab('news')" id="btn-adm-news" class="admin-nav-item"><i class="fa-solid fa-newspaper"></i> Notícias</button>
                <button onclick="window.app.admTab('quotes')" id="btn-adm-quotes" class="admin-nav-item"><i class="fa-solid fa-quote-right"></i> Frases</button>
                <button onclick="window.app.admTab('videos')" id="btn-adm-videos" class="admin-nav-item"><i class="fa-solid fa-dumbbell"></i> Vídeos</button>
            </nav>
            <button onclick="window.app.closeAdmin()" class="admin-logout-btn"><i class="fa-solid fa-arrow-left"></i> Voltar ao App</button>
        </aside>

        <main class="admin-main">
            <header class="admin-topbar">
                <h2 id="admin-page-title" style="margin:0; font-size:20px; color:var(--text-main);">Gerenciamento de Alunos</h2>
                <div class="admin-user-info"><span style="font-size:12px; color:#666;">Logado como Admin</span></div>
            </header>

            <div class="admin-content-scroll">
                <!-- 1. ALUNOS -->
                <div id="adm-content-users" class="admin-section-content">
                    <div class="admin-section-header">
                        <h3>Gestão de Alunos</h3>
                        <div style="font-size:12px; color:#666;" id="adm-users-count">A carregar...</div>
                    </div>
                    <div class="admin-filters-bar">
                        <div style="position:relative; flex: 2;">
                            <i class="fa-solid fa-search" style="position:absolute; left:12px; top:12px; color:#ccc;"></i>
                            <input type="text" id="filter-search" class="adm-search-input" style="padding-left: 35px;" placeholder="Pesquisar por nome ou email..." onkeyup="window.app.filterUsers()">
                        </div>
                        <select id="filter-status" class="adm-filter-select" onchange="window.app.filterUsers()">
                            <option value="all">Todos</option>
                            <option value="active_real">Em dia (< 7 dias)</option>
                            <option value="late">Atrasados (7 - 15 dias)</option>
                            <option value="inactive_real">Inativos (> 15 dias)</option>
                            <option value="pending">Pendentes / Bloqueados</option>
                        </select>
                        <button class="btn-outline" onclick="window.app.admLoadUsers()" style="padding: 10px 15px; width:auto; margin:0; border-radius:8px;"><i class="fa-solid fa-rotate-right"></i></button>
                    </div>
                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead><tr><th width="50">Avatar</th><th>Nome / Email</th><th>Estado</th><th>Último Treino</th><th>Progresso</th><th width="50">Ações</th></tr></thead>
                            <tbody id="adm-users-table-body"></tbody>
                        </table>
                    </div>
                    <div id="adm-users-empty" style="padding:40px; text-align:center; color:#999; display:none;">Nenhum aluno encontrado com estes filtros.</div>
                </div>

                <!-- PÁGINA DE DETALHE DO ALUNO -->
                <div id="adm-user-detail-view" class="hidden">
                    <button onclick="window.app.closeUserDetail()" style="margin-bottom:15px; border:none; background:none; cursor:pointer; color:#666; font-weight:600; display:flex; align-items:center; gap:5px;"><i class="fa-solid fa-arrow-left"></i> Voltar à lista</button>
                    <div class="user-detail-header">
                        <img id="ud-img" src="" class="ud-avatar-large">
                        <div class="ud-info" style="flex:1;">
                            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                                <div><h2 id="ud-name">Nome</h2><p id="ud-email">email</p><p id="ud-location" style="margin-top:5px;"><i class="fa-solid fa-location-dot"></i> <span>--</span></p></div>
                                <div id="ud-actions-top"></div>
                            </div>
                            <div class="ud-stats-grid">
                                <div class="ud-stat-box"><small>Idade</small><strong id="ud-age">--</strong></div>
                                <div class="ud-stat-box"><small>Peso Atual</small><strong id="ud-weight">--</strong></div>
                                <div class="ud-stat-box"><small>Altura</small><strong id="ud-height">--</strong></div>
                                <div class="ud-stat-box"><small>Últ. Acesso</small><strong id="ud-last-active" style="color:var(--text-sec);">--</strong></div>
                            </div>
                        </div>
                    </div>
                    <div class="ud-sections-grid">
                        <div>
                            <div class="ud-section">
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
                                    <h3 style="margin:0; border:none; padding:0;">Objetivos & Treinos</h3>
                                    <button id="btn-ud-add-race" class="btn-primary" style="width:auto; font-size:11px; padding:5px 12px; margin:0;">+ Novo Objetivo</button>
                                </div>
                                <div id="ud-races-list"></div>
                            </div>
                        </div>
                        <div>
                            <div class="ud-section">
                                <h3>Notas & Observações</h3>
                                <textarea id="ud-admin-notes" class="input" style="height:100px; font-size:13px; resize:none;" placeholder="Notas privadas sobre este aluno..."></textarea>
                                <button onclick="window.app.saveAdminNotes()" class="btn-outline" style="width:100%; margin-top:10px; font-size:12px;">Guardar Notas</button>
                            </div>
                            <div class="ud-section">
                                <h3>Histórico de Dor</h3>
                                <div id="ud-pain-mini-list" style="max-height:300px; overflow-y:auto;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="adm-content-physio" class="admin-section-content hidden">
                    <div class="admin-section-header"><h3>Relatos de Dor</h3></div>
                    <div id="adm-physio-list" class="admin-grid-list"></div>
                </div>
                
                <div id="adm-content-templates" class="admin-section-content hidden">
                    <div class="admin-section-header"><h3>Modelos de Treino</h3><button onclick="window.app.admAddTemplateInline()" class="btn-primary" style="padding:8px 20px; font-size:12px; border-radius:20px; width:auto;">+ Novo Modelo</button></div>
                    <div id="adm-templates-list" class="admin-grid-list"></div>
                </div>

                <div id="adm-content-news" class="admin-section-content hidden">
                    <div class="admin-section-header"><h3>Publicar Novidade</h3></div>
                    <div class="card" style="max-width:600px;">
                        <input id="news-title" class="input" placeholder="Título da Notícia" style="margin-bottom:10px;">
                        <textarea id="news-body" class="input" placeholder="Escreva o conteúdo..." style="margin-bottom:10px; height:120px; resize:none;"></textarea>
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                            <button onclick="document.getElementById('news-file').click()" class="btn btn-outline" style="width:auto; margin:0; font-size:12px;"><i class="fa-solid fa-image"></i> Adicionar Foto</button>
                            <span style="font-size:11px; color:#888;">Opcional</span>
                        </div>
                        <input type="file" id="news-file" hidden onchange="window.app.previewNewsImg(this)">
                        <img id="news-preview" style="width:100%; height:150px; object-fit:cover; display:none; margin-bottom:15px; border-radius:10px;">
                        <button id="btn-post-news" onclick="window.app.postNews()" class="btn btn-primary" style="width:100%; margin:0;">Publicar Agora</button>
                    </div>
                    <h4 style="margin-top:30px; margin-bottom:15px;">Histórico de Publicações</h4>
                    <div id="adm-news-history"></div>
                </div>

                <div id="adm-content-quotes" class="admin-section-content hidden">
                    <div class="admin-section-header"><h3>Frases Motivacionais</h3></div>
                    <div class="card" style="max-width:600px;">
                        <textarea id="adm-quote-text" class="input" placeholder="Digite a frase do dia..." style="margin-bottom:15px; resize:none;"></textarea>
                        <button onclick="window.app.postQuote()" class="btn btn-primary" style="width:100%; margin:0;">Adicionar Frase</button>
                    </div>
                    <div id="adm-quotes-list" class="admin-list-simple"></div>
                </div>

                <div id="adm-content-videos" class="admin-section-content hidden">
                    <div class="admin-section-header"><h3>Vídeos de Fortalecimento</h3></div>
                    <div class="card" style="max-width:600px;">
                        <input id="adm-video-title" class="input" placeholder="Título do Exercício" style="margin-bottom:10px;">
                        <input id="adm-video-link" class="input" placeholder="Link do Vídeo (Youtube/etc)" style="margin-bottom:15px;">
                        <button onclick="window.app.admAddStrengthVideo()" class="btn btn-primary" style="width:100%; margin:0;">Cadastrar Vídeo</button>
                    </div>
                    <div id="adm-videos-list" class="admin-list-simple"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- JS MODULE LINKADO -->
    <script type="module" src="app.js?v=7"></script>
</body>
</html>
